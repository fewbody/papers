<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recent Nuclear Theory Publications</title>
    <style>
        :root {
            --primary-color: #0071e3;
            --secondary-color: #86b9ff;
            --light-gray: #f5f5f7;
            --medium-gray: #86868b;
            --dark-gray: #1d1d1f;
            --card-bg: #ffffff;
            --card-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2.5rem;
            --spacing-xl: 4rem;
            --border-radius: 12px;
            --transition: all 0.3s ease-in-out;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--light-gray);
            color: var(--dark-gray);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        header {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: var(--spacing-md) var(--spacing-xl);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        .last-updated {
            color: var(--medium-gray);
            font-size: 0.9rem;
        }
        
        .data-toggle {
            color: var(--medium-gray);
            font-size: 0.9rem;
            margin-top: var(--spacing-xs);
        }
        
        .data-toggle label {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .data-toggle input[type="checkbox"] {
            accent-color: var(--primary-color);
        }

        .controls {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-md) var(--spacing-xl);
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .search-container {
            position: relative;
            flex-grow: 1;
            max-width: 500px;
        }

        .search-input {
            width: 100%;
            padding: var(--spacing-sm);
            padding-left: 40px;
            border-radius: 8px;
            border: none;
            background-color: #ffffff;
            font-size: 1rem;
            outline: none;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--medium-gray);
        }

        .filter-dropdown {
            padding: var(--spacing-sm);
            border-radius: 8px;
            border: none;
            background-color: #ffffff;
            font-size: 1rem;
            outline: none;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
            cursor: pointer;
        }

        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-md) var(--spacing-xl);
        }

        .publications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }

        .publication-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            overflow: hidden;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .publication-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 30px rgba(0, 0, 0, 0.12);
        }

        .card-content {
            padding: var(--spacing-md);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            flex-grow: 1;
        }

        .publication-source {
            display: inline-block;
            padding: 0.3rem 0.6rem;
            background-color: var(--light-gray);
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--medium-gray);
        }

        .publication-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin: var(--spacing-xs) 0;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .publication-authors {
            color: var(--medium-gray);
            font-size: 0.9rem;
            margin-bottom: var(--spacing-xs);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .publication-summary {
            color: var(--dark-gray);
            font-size: 0.95rem;
            display: -webkit-box;
            -webkit-line-clamp: 6;
            -webkit-box-orient: vertical;
            overflow: hidden;
            flex-grow: 1;
        }

        .publication-link {
            display: inline-block;
            margin-top: var(--spacing-sm);
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .publication-link:hover {
            text-decoration: underline;
        }

        .loading {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--medium-gray);
            font-size: 1.2rem;
        }

        .error-message {
            background-color: #fff3f3;
            color: #d32f2f;
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-md);
            text-align: center;
        }

        .load-more {
            display: block;
            margin: var(--spacing-lg) auto;
            padding: var(--spacing-sm) var(--spacing-lg);
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .load-more:hover {
            background-color: #0058b6;
        }

        .load-more:disabled {
            background-color: var(--medium-gray);
            cursor: not-allowed;
        }

        footer {
            background-color: var(--card-bg);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding: var(--spacing-md) var(--spacing-xl);
            text-align: center;
            color: var(--medium-gray);
            font-size: 0.9rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            header, .controls, main {
                padding-left: var(--spacing-md);
                padding-right: var(--spacing-md);
            }

            h1 {
                font-size: 2rem;
            }

            .publications-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --light-gray: #1a1a1a;
                --medium-gray: #86868b;
                --dark-gray: #f5f5f7;
                --card-bg: #2a2a2a;
                --card-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
            }

            body {
                background-color: #000;
            }

            header {
                background-color: rgba(42, 42, 42, 0.8);
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .search-input, .filter-dropdown {
                background-color: #1a1a1a;
                color: #f5f5f7;
            }

            .publication-source {
                background-color: #1a1a1a;
            }

            footer {
                background-color: #1a1a1a;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>Recent Nuclear Theory Publications</h1>
            <p class="last-updated">Last updated: <span id="lastUpdated">Loading...</span></p>
            <p class="data-toggle">
                <label>
                    <input type="checkbox" id="toggleDataSource"> Show all historical publications
                </label>
            </p>
        </div>
    </header>

    <div class="controls">
        <div class="search-container">
            <span class="search-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15.7071 14.2929L12.0252 10.6109C13.0903 9.41496 13.7165 7.83757 13.7165 6.12325C13.7165 2.74731 10.9692 0 7.59323 0C4.21729 0 1.47 2.74731 1.47 6.12325C1.47 9.49919 4.21729 12.2465 7.59323 12.2465C9.30755 12.2465 10.8849 11.6203 12.0809 10.5552L15.7629 14.2371C15.8544 14.3287 15.9765 14.375 16.0986 14.375C16.2207 14.375 16.3428 14.3287 16.4343 14.2371C16.6174 14.054 16.6174 13.7598 15.7071 14.2929ZM7.59323 10.9872C4.91557 10.9872 2.72925 8.80091 2.72925 6.12325C2.72925 3.44559 4.91557 1.25925 7.59323 1.25925C10.2709 1.25925 12.4572 3.44559 12.4572 6.12325C12.4572 8.80091 10.2709 10.9872 7.59323 10.9872Z" fill="#86868B"/>
                </svg>
            </span>
            <input type="text" id="searchInput" class="search-input" placeholder="Search by title, author, or keyword">
        </div>
        <select id="sourceFilter" class="filter-dropdown">
            <option value="all">All Sources</option>
            <!-- Sources will be populated dynamically -->
        </select>
        <select id="sortBy" class="filter-dropdown">
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="title">Title (A-Z)</option>
            <option value="source">Source</option>
        </select>
    </div>

    <main>
        <div id="publicationsContainer" class="publications-grid">
            <div class="loading">Loading publications...</div>
        </div>
        <button id="loadMoreButton" class="load-more" disabled>Load More</button>
    </main>

    <footer>
        <p>© 2025 Nuclear Theory Publications. <span id="dataSourceInfo">Currently showing newest publications only.</span></p>
        <p>Designed and made by <a href="http://jinlei.fewbody.com/">Jin Lei</a>. Supported by the National Natural Science Foundation of China (Grants No. 12475132). If you find any bugs or errors related to this website, please <a href="mailto:jinl@tongji.edu.cn">email me</a>.</p>
    </footer>

    <script>
        // Configuration
        const DATA_URL = 'data.json';
        const SOURCE_URL = 'source.json'; // Add source.json URL
        const ITEMS_PER_PAGE = 12;
        let allPublications = [];
        let filteredPublications = [];
        let currentPage = 1;
        let allSources = new Set();
        let useSourceData = false; // Flag to determine which data source to use

        // Fetch data from the JSON file
        async function fetchData() {
            try {
                // Determine which URL to use based on toggle state
                const url = useSourceData ? SOURCE_URL : DATA_URL;
                const response = await fetch(url);
                
                if (!response.ok) {
                    // If source.json fails but we're trying to use it, fall back to data.json
                    if (useSourceData) {
                        console.warn('Failed to load source.json, falling back to data.json');
                        const dataResponse = await fetch(DATA_URL);
                        if (!dataResponse.ok) {
                            throw new Error('Failed to load both source and data files');
                        }
                        const data = await dataResponse.json();
                        processData(data);
                        return;
                    }
                    throw new Error('Network response was not ok');
                }
                
                const data = await response.json();
                processData(data);
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('publicationsContainer').innerHTML = 
                    `<div class="error-message">Failed to load publications: ${error.message}</div>`;
                document.getElementById('loadMoreButton').disabled = true;
            }
        }
        
        // Process the fetched data
        function processData(data) {
            // Update last updated time
            const lastUpdated = new Date(data.lastUpdated);
            document.getElementById('lastUpdated').textContent = formatDate(lastUpdated);
            
            // Process publications
            allPublications = data.papers;
            
            // Extract all sources for filtering
            allSources.clear();
            allPublications.forEach(pub => {
                if (pub.source) {
                    allSources.add(pub.source);
                }
            });
            
            // Populate source filter dropdown
            populateSourceFilter();
            
            // Apply initial sorting and filtering
            applyFiltersAndSort();
            
            // Remove loading indicator if it exists
            const loadingElement = document.querySelector('.loading');
            if (loadingElement) {
                loadingElement.remove();
            }
        }

        // Format date to a user-friendly string
        function formatDate(date) {
            return date.toLocaleString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                timeZoneName: 'short'
            });
        }

        // Populate source filter dropdown
        function populateSourceFilter() {
            const sourceFilter = document.getElementById('sourceFilter');
            
            // Clear existing options except the first one
            while (sourceFilter.options.length > 1) {
                sourceFilter.remove(1);
            }
            
            // Add source options
            [...allSources].sort().forEach(source => {
                const option = document.createElement('option');
                option.value = source;
                option.textContent = source;
                sourceFilter.appendChild(option);
            });
        }

        // Apply filters and sorting
        function applyFiltersAndSort() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const sourceFilter = document.getElementById('sourceFilter').value;
            const sortBy = document.getElementById('sortBy').value;
            
            // Filter publications
            filteredPublications = allPublications.filter(pub => {
                // Source filter
                if (sourceFilter !== 'all' && pub.source !== sourceFilter) {
                    return false;
                }
                
                // Search filter
                if (searchText) {
                    const titleMatch = pub.title && pub.title.toLowerCase().includes(searchText);
                    const authorMatch = pub.authors && pub.authors.toLowerCase().includes(searchText);
                    const summaryMatch = pub.summary && pub.summary.toLowerCase().includes(searchText);
                    return titleMatch || authorMatch || summaryMatch;
                }
                
                return true;
            });
            
            // Sort publications
            filteredPublications.sort((a, b) => {
                switch (sortBy) {
                    case 'title':
                        return (a.title || '').localeCompare(b.title || '');
                    case 'source':
                        return (a.source || '').localeCompare(b.source || '');
                    // For now, without specific publication dates, we'll use array order
                    case 'newest':
                        return -1; // Assuming the array is already in the desired order
                    case 'oldest':
                        return 1;
                    default:
                        return -1;
                }
            });
            
            // Reset to the first page
            currentPage = 1;
            
            // Render publications
            renderPublications();
            
            // Update load more button state
            updateLoadMoreButton();
        }

        // Render publications
        function renderPublications() {
            const container = document.getElementById('publicationsContainer');
            
            // Clear container for initial load or when filters change
            if (currentPage === 1) {
                container.innerHTML = '';
            }
            
            // Calculate slice for pagination
            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = startIndex + ITEMS_PER_PAGE;
            const publicationsToDisplay = filteredPublications.slice(startIndex, endIndex);
            
            // If no results found
            if (publicationsToDisplay.length === 0 && currentPage === 1) {
                container.innerHTML = '<div class="error-message">No publications found matching your criteria.</div>';
                return;
            }
            
            // Create publication cards
            publicationsToDisplay.forEach(pub => {
                const card = createPublicationCard(pub);
                container.appendChild(card);
            });
        }

        // Create a publication card
        function createPublicationCard(publication) {
            const card = document.createElement('div');
            card.className = 'publication-card';
            
            const cardContent = document.createElement('div');
            cardContent.className = 'card-content';
            
            // Source
            if (publication.source) {
                const sourceElem = document.createElement('span');
                sourceElem.className = 'publication-source';
                sourceElem.textContent = publication.source;
                cardContent.appendChild(sourceElem);
            }
            
            // Title
            const titleElem = document.createElement('h2');
            titleElem.className = 'publication-title';
            titleElem.textContent = publication.title || 'No Title Available';
            cardContent.appendChild(titleElem);
            
            // Authors
            if (publication.authors && publication.authors !== 'Unknown') {
                const authorsElem = document.createElement('p');
                authorsElem.className = 'publication-authors';
                authorsElem.textContent = publication.authors;
                cardContent.appendChild(authorsElem);
            }
            
            // Summary
            if (publication.summary) {
                const summaryElem = document.createElement('p');
                summaryElem.className = 'publication-summary';
                summaryElem.textContent = publication.summary;
                cardContent.appendChild(summaryElem);
            }
            
            // Link
            if (publication.link && publication.link !== '#') {
                const linkElem = document.createElement('a');
                linkElem.className = 'publication-link';
                linkElem.href = publication.link;
                linkElem.target = '_blank';
                linkElem.rel = 'noopener noreferrer';
                linkElem.textContent = 'Read Full Paper →';
                cardContent.appendChild(linkElem);
            }
            
            card.appendChild(cardContent);
            return card;
        }

        // Update load more button state
        function updateLoadMoreButton() {
            const button = document.getElementById('loadMoreButton');
            const startIndex = currentPage * ITEMS_PER_PAGE;
            
            if (startIndex < filteredPublications.length) {
                button.disabled = false;
            } else {
                button.disabled = true;
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Fetch and display data
            fetchData();
            
            // Search input
            document.getElementById('searchInput').addEventListener('input', debounce(() => {
                applyFiltersAndSort();
            }, 300));
            
            // Source filter
            document.getElementById('sourceFilter').addEventListener('change', () => {
                applyFiltersAndSort();
            });
            
            // Sort filter
            document.getElementById('sortBy').addEventListener('change', () => {
                applyFiltersAndSort();
            });
            
            // Load more button
            document.getElementById('loadMoreButton').addEventListener('click', () => {
                currentPage++;
                renderPublications();
                updateLoadMoreButton();
            });
            
            // Toggle between data sources
            document.getElementById('toggleDataSource').addEventListener('change', (e) => {
                useSourceData = e.target.checked;
                
                // Clear the current display and show loading
                document.getElementById('publicationsContainer').innerHTML = '<div class="loading">Loading publications...</div>';
                document.getElementById('loadMoreButton').disabled = true;
                
                // Update the data source info text
                document.getElementById('dataSourceInfo').textContent = useSourceData 
                    ? 'Currently showing all historical publications.' 
                    : 'Currently showing newest publications only.';
                
                // Fetch data from the appropriate source
                fetchData();
            });
        });

        // Debounce function for search input
        function debounce(func, delay) {
            let timeoutId;
            return function() {
                const context = this;
                const args = arguments;
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => {
                    func.apply(context, args);
                }, delay);
            };
        }
    </script>
</body>
</html>